---
import Layout from '../layouts/Layout.astro';
import { SupabaseHouseDataSource } from '../../infrastructure/datasources/SupabaseHouseDataSource';
import { HouseRepositoryImpl } from '../../infrastructure/repositories/HouseRepositoryImpl';
import { GetHousesUseCase } from '../../application/useCases/houses/GetHousesUseCase';

// Inicializar dependencias
const dataSource = new SupabaseHouseDataSource();
const repository = new HouseRepositoryImpl(dataSource);
const getHousesUseCase = new GetHousesUseCase(repository);

// Obtener casas
const houses = await getHousesUseCase.execute(0, 9);
---

<Layout>
  <main class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-6">Available Houses</h1>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {houses.map(house => (
        <article class="border rounded-lg overflow-hidden shadow-lg">
          <div class="p-4">
            <h2 class="text-xl font-semibold mb-2">{house.title}</h2>
            <p class="text-gray-600 mb-4">{house.description}</p>
            <div class="flex justify-between items-center">
              <p class="text-lg font-bold">${house.price_per_night}/night</p>
              <div class="text-sm text-gray-500">
                {house.bedrooms} beds â€¢ {house.bathrooms} baths
              </div>
            </div>
            <p class="mt-2 text-sm">
              <span class={`inline-block px-2 py-1 rounded ${house.is_available ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                {house.is_available ? 'Available' : 'Not Available'}
              </span>
              <span class="ml-2">{house.city}</span>
            </p>
          </div>
        </article>
      ))}
    </div>
  </main>
</Layout>
---